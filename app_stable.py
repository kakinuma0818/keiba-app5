import streamlit as st
import pandas as pd

st.set_page_config(page_title="ç«¶é¦¬ã‚¢ãƒ—ãƒªï¼ˆå®‰å®šç‰ˆï¼‰", layout="wide")

# ---------------------------------------------------
# ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆã—ã°ã‚‰ãã¯ã“ã®ã¾ã¾ã§OKï¼‰
# ---------------------------------------------------
demo_horses = [
    {"æ ": 1, "é¦¬ç•ª": 1, "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹A", "æ€§é½¢": "ç‰¡4", "æ–¤é‡": 55.0, "é¨æ‰‹": "å·ç”°"},
    {"æ ": 2, "é¦¬ç•ª": 2, "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹B", "æ€§é½¢": "ç‰3", "æ–¤é‡": 53.0, "é¨æ‰‹": "ãƒ«ãƒ¡ãƒ¼ãƒ«"},
    {"æ ": 3, "é¦¬ç•ª": 3, "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹C", "æ€§é½¢": "ç‰¡5", "æ–¤é‡": 57.0, "é¨æ‰‹": "æ­¦è±Š"},
]
df_demo = pd.DataFrame(demo_horses)

# ---------------------------------------------------
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆä»Šã¯1ç”»é¢ã ã‘ã ãŒå°†æ¥æ‹¡å¼µç”¨ï¼‰
# ---------------------------------------------------
st.title("ç«¶é¦¬ã‚¢ãƒ—ãƒªï¼ˆå®‰å®šç‰ˆ UI ãƒ†ã‚¹ãƒˆï¼‰")
menu = st.radio("ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ", ["è§£æç”»é¢"], horizontal=True, key="main_menu")

if menu == "è§£æç”»é¢":

    # ---------------------------------------------------
    # 5ã‚¿ãƒ–æ§‹æˆ
    # ---------------------------------------------------
    tab_shutuba, tab_score, tab_ai, tab_baken, tab_info = st.tabs(
        ["å‡ºé¦¬è¡¨", "ã‚¹ã‚³ã‚¢", "AIã‚¹ã‚³ã‚¢", "é¦¬åˆ¸", "åŸºæœ¬æƒ…å ±"]
    )

    # ---------------------------------------------------
    # å‡ºé¦¬è¡¨ã‚¿ãƒ–ï¼šå°ã‚»ãƒ¬ã‚¯ãƒˆ + å‡ºé¦¬è¡¨ã«å°ã‚«ãƒ©ãƒ 
    # ---------------------------------------------------
    with tab_shutuba:
        st.subheader("å‡ºé¦¬è¡¨ ï¼‹ å°å…¥åŠ›")

        marks = ["", "â—", "â—¯", "â–²", "â–³", "Ã—", "â­ï¸"]

        # ğŸ”¹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆã®åˆæœŸåŒ–ï¼ˆã“ã“ã§ã ã‘ã‚„ã‚‹ï¼‰
        if "marks" not in st.session_state:
            st.session_state.marks = {idx: "" for idx in df_demo.index}

        st.markdown("#### å°ã®å…¥åŠ›")

        # é¦¬ã”ã¨ã«å°ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º
        for idx, row in df_demo.iterrows():
            key = f"mark_{idx}"
            # åˆæœŸå€¤ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰å–å¾—ï¼ˆç„¡ã‘ã‚Œã°ç©ºæ–‡å­—ï¼‰
            default_val = st.session_state.marks.get(idx, "")
            default_index = marks.index(default_val) if default_val in marks else 0

            selected = st.selectbox(
                f"{row['é¦¬å']} ã®å°",
                marks,
                index=default_index,
                key=key,
            )
            # ã‚»ãƒƒã‚·ãƒ§ãƒ³å´ã®ç®¡ç†ç”¨ dict ã‚‚æ›´æ–°
            st.session_state.marks[idx] = selected

        # å‡ºé¦¬è¡¨ã«ã€Œå°ã€ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
        df_with_mark = df_demo.copy()
        df_with_mark["å°"] = [
            st.session_state.marks.get(idx, "") for idx in df_demo.index
        ]

        st.markdown("#### å°ä»˜ãå‡ºé¦¬è¡¨ï¼ˆç¢ºèªç”¨ï¼‰")
        st.dataframe(df_with_mark, width="stretch")

    # ---------------------------------------------------
    # ã‚¹ã‚³ã‚¢ã‚¿ãƒ–ï¼šæ‰‹å‹•ã‚¹ã‚³ã‚¢ã®ã¿ï¼ˆå°ã¯ä¸€åˆ‡å‡ºã•ãªã„ï¼‰
    # ---------------------------------------------------
    with tab_score:
        st.subheader("æ‰‹å‹•ã‚¹ã‚³ã‚¢å…¥åŠ›")

        # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆåˆæœŸåŒ–ï¼ˆã‚¹ã‚³ã‚¢ç”¨ï¼‰
        if "manual_scores" not in st.session_state:
            st.session_state.manual_scores = [50] * len(df_demo)

        new_scores = []

        st.markdown("#### é¦¬ã”ã¨ã®ã‚¹ã‚³ã‚¢å…¥åŠ›")
        for idx, row in df_demo.iterrows():
            score = st.number_input(
                f"{row['é¦¬å']} ã®ã‚¹ã‚³ã‚¢",
                min_value=0,
                max_value=100,
                value=st.session_state.manual_scores[idx],
                key=f"manual_score_{idx}",
            )
            new_scores.append(score)

        # æ›´æ–°
        st.session_state.manual_scores = new_scores

        # ã‚¹ã‚³ã‚¢ä»˜ãã®ç¢ºèªç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°ã¯è¡¨ç¤ºã—ãªã„ï¼‰
        df_score = df_demo.copy()
        df_score["æ‰‹å‹•ã‚¹ã‚³ã‚¢"] = st.session_state.manual_scores

        st.markdown("#### ã‚¹ã‚³ã‚¢ä»˜ãå‡ºé¦¬è¡¨ï¼ˆç¢ºèªç”¨ï¼‰")
        st.dataframe(df_score, width="stretch")

    # ---------------------------------------------------
    # AIã‚¹ã‚³ã‚¢ã‚¿ãƒ–ï¼šä»®è¡¨ç¤º
    # ---------------------------------------------------
    with tab_ai:
        st.subheader("AIã‚¹ã‚³ã‚¢ï¼ˆä»®ï¼‰")
        st.info("ã“ã“ã«AIç®—å‡ºã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºäºˆå®šã§ã™ã€‚ï¼ˆä»Šã¯ãƒ‡ãƒ¢è¡¨ç¤ºï¼‰")
        st.dataframe(df_demo, width="stretch")

    # ---------------------------------------------------
    # é¦¬åˆ¸ã‚¿ãƒ–ï¼šä»®è¡¨ç¤º
    # ---------------------------------------------------
    with tab_baken:
        st.subheader("é¦¬åˆ¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä»®ï¼‰")
        st.write("ã“ã“ã«ã€å°ã‚„ã‚¹ã‚³ã‚¢ã‚’ä½¿ã£ãŸé¦¬åˆ¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…äºˆå®šã§ã™ã€‚")

    # ---------------------------------------------------
    # åŸºæœ¬æƒ…å ±ã‚¿ãƒ–ï¼šä»®è¡¨ç¤º
    # ---------------------------------------------------
    with tab_info:
        st.subheader("ãƒ¬ãƒ¼ã‚¹åŸºæœ¬æƒ…å ±ï¼ˆä»®ï¼‰")
        st.write("ã“ã“ã«ãƒ¬ãƒ¼ã‚¹åãƒ»é–‹å‚¬å ´ãƒ»è·é›¢ãƒ»å¤©å€™ãªã©ã®æƒ…å ±ã‚’è¡¨ç¤ºäºˆå®šã§ã™ã€‚")
