import streamlit as st
import pandas as pd

# ---------------------------------------------------
# åŸºæœ¬è¨­å®š
# ---------------------------------------------------
st.set_page_config(page_title="ç«¶é¦¬ã‚¢ãƒ—ãƒªï¼ˆæœ¬ç•ªå®‰å®šç‰ˆï¼‰", layout="wide")

st.title("ğŸ‡ ç«¶é¦¬ã‚¢ãƒ—ãƒªï¼ˆæœ¬ç•ªå®‰å®šç‰ˆï¼‰")
st.caption("å‡ºé¦¬è¡¨ã‚¿ãƒ–ã«å°ã‚»ãƒ¬ã‚¯ãƒˆï¼‹å°ä»˜ãå‡ºé¦¬è¡¨ã‚’å®Ÿè£…æ¸ˆã¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³")

# ---------------------------------------------------
# å‡ºé¦¬è¡¨ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬ç•ªç”¨ã‚«ãƒ©ãƒ æ§‹æˆã®ã‚µãƒ³ãƒ—ãƒ«ï¼‰
# ---------------------------------------------------
horses = [
    {
        "æ ": 1,
        "é¦¬ç•ª": 1,
        "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹A",
        "æ€§é½¢": "ç‰¡4",
        "æ–¤é‡": 55.0,
        "é¨æ‰‹": "å·ç”°",
        "èª¿æ•™å¸«": "ä¸­å†…ç”°",
        "é¦¬ä¸»": "ã‚µãƒ³ãƒ—ãƒ«ã‚ªãƒ¼ãƒŠãƒ¼A",
        "ç”Ÿç”£è€…": "ãƒãƒ¼ã‚¶ãƒ³F",
        "çˆ¶": "ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ãƒ¤ãƒ¼A",
        "æ¯": "ã‚µãƒ³ãƒ—ãƒ«ãƒã‚¶ãƒ¼A",
        "æ¯çˆ¶": "ãƒ‡ã‚£ãƒ¼ãƒ—ç³»",
        "å‰èµ°": "å¤©çš‡è³ç§‹ 5ç€",
        "ã‚ªãƒƒã‚º": 3.8,
        "äººæ°—": 1,
    },
    {
        "æ ": 2,
        "é¦¬ç•ª": 2,
        "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹B",
        "æ€§é½¢": "ç‰3",
        "æ–¤é‡": 53.0,
        "é¨æ‰‹": "ãƒ«ãƒ¡ãƒ¼ãƒ«",
        "èª¿æ•™å¸«": "å›½æ",
        "é¦¬ä¸»": "ã‚µãƒ³ãƒ—ãƒ«ã‚ªãƒ¼ãƒŠãƒ¼B",
        "ç”Ÿç”£è€…": "ãƒãƒ¼ã‚¶ãƒ³F",
        "çˆ¶": "ãƒ­ãƒ¼ãƒ‰ã‚«ãƒŠãƒ­ã‚¢",
        "æ¯": "ã‚µãƒ³ãƒ—ãƒ«ãƒã‚¶ãƒ¼B",
        "æ¯çˆ¶": "ã‚­ãƒ³ã‚°ã‚«ãƒ¡ãƒãƒ¡ãƒ",
        "å‰èµ°": "ã‚ªãƒ¼ã‚¯ã‚¹ 2ç€",
        "ã‚ªãƒƒã‚º": 5.5,
        "äººæ°—": 2,
    },
    {
        "æ ": 3,
        "é¦¬ç•ª": 3,
        "é¦¬å": "ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹C",
        "æ€§é½¢": "ç‰¡5",
        "æ–¤é‡": 57.0,
        "é¨æ‰‹": "æ­¦è±Š",
        "èª¿æ•™å¸«": "å‹é“",
        "é¦¬ä¸»": "ã‚µãƒ³ãƒ—ãƒ«ã‚ªãƒ¼ãƒŠãƒ¼C",
        "ç”Ÿç”£è€…": "ç¤¾å°F",
        "çˆ¶": "ãƒãƒ¼ãƒ„ã‚¯ãƒ©ã‚¤",
        "æ¯": "ã‚µãƒ³ãƒ—ãƒ«ãƒã‚¶ãƒ¼C",
        "æ¯çˆ¶": "ã‚µãƒ³ãƒ‡ãƒ¼ç³»",
        "å‰èµ°": "æœ­å¹Œè¨˜å¿µ 3ç€",
        "ã‚ªãƒƒã‚º": 8.7,
        "äººæ°—": 3,
    },
]

df = pd.DataFrame(horses)

# ---------------------------------------------------
# å°ãƒã‚¹ã‚¿ ï¼‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆ
# ---------------------------------------------------
MARK_LIST = ["", "â—", "â—‹", "â–²", "â–³", "Ã—", "â­ï¸"]  # â­ï¸â†ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šã®å½¢

if "marks" not in st.session_state:
    st.session_state.marks = [""] * len(df)

if "manual_scores" not in st.session_state:
    st.session_state.manual_scores = [50] * len(df)

# ---------------------------------------------------
# ã‚¿ãƒ–æ§‹æˆï¼ˆ5ã¤å›ºå®šï¼‰
# ---------------------------------------------------
tab_shutuba, tab_score, tab_ai, tab_baken, tab_info = st.tabs(
    ["å‡ºé¦¬è¡¨", "ã‚¹ã‚³ã‚¢", "AIã‚¹ã‚³ã‚¢", "é¦¬åˆ¸", "åŸºæœ¬æƒ…å ±"]
)

# ---------------------------------------------------
# å‡ºé¦¬è¡¨ã‚¿ãƒ–ï¼ˆå°ã‚»ãƒ¬ã‚¯ãƒˆ + å°ä»˜ãå‡ºé¦¬è¡¨ï¼‰
# ---------------------------------------------------
with tab_shutuba:
    st.subheader("ğŸ“ å‡ºé¦¬è¡¨ ï¼‹ å°å…¥åŠ›")

    st.write("### å°ã®é¸æŠï¼ˆä¸Šã§é¸ã‚“ã ã‚‚ã®ãŒä¸‹ã®å‡ºé¦¬è¡¨ã«åæ˜ ã•ã‚Œã¾ã™ï¼‰")

    new_marks = []
    for i, row in df.iterrows():
        key = f"mark_select_{i}"
        selected = st.selectbox(
            f"{row['é¦¬å']} ã®å°",
            MARK_LIST,
            index=MARK_LIST.index(st.session_state.marks[i]),
            key=key,
        )
        new_marks.append(selected)

    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆã‚’æ›´æ–°
    st.session_state.marks = new_marks

    # è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    df_display = df.copy()
    df_display["å°"] = st.session_state.marks

    st.write("### å°ä»˜ãå‡ºé¦¬è¡¨")
    st.dataframe(
        df_display,
        width="stretch",
        hide_index=True,
    )

# ---------------------------------------------------
# ã‚¹ã‚³ã‚¢ã‚¿ãƒ–ï¼ˆå‹•ä½œç¢ºèªç”¨ï¼šnumber_input â†’ å‡ºé¦¬è¡¨ã«åæ˜ ï¼‰
# ---------------------------------------------------
with tab_score:
    st.subheader("ğŸ”¢ ã‚¹ã‚³ã‚¢ï¼ˆæ‰‹å‹•å…¥åŠ›ãƒ‡ãƒ¢ï¼‰")

    new_scores = []
    for i, row in df.iterrows():
        key = f"manual_score_{i}"
        val = st.number_input(
            f"{row['é¦¬å']} ã®ã‚¹ã‚³ã‚¢",
            min_value=0,
            max_value=100,
            value=int(st.session_state.manual_scores[i]),
            key=key,
        )
        new_scores.append(val)

    st.session_state.manual_scores = new_scores

    df_score = df.copy()
    df_score["æ‰‹å‹•ã‚¹ã‚³ã‚¢"] = st.session_state.manual_scores
    df_score["å°"] = st.session_state.marks  # å‡ºé¦¬è¡¨ã‚¿ãƒ–ã®å°ã‚‚ä¸€ç·’ã«ç¢ºèª

    st.write("### æ‰‹å‹•ã‚¹ã‚³ã‚¢ä»˜ãå‡ºé¦¬è¡¨ï¼ˆç¢ºèªç”¨ï¼‰")
    st.dataframe(df_score, width="stretch", hide_index=True)

# ---------------------------------------------------
# AIã‚¹ã‚³ã‚¢ã‚¿ãƒ–ï¼ˆä»®ï¼‰
# ---------------------------------------------------
with tab_ai:
    st.subheader("ğŸ¤– AIã‚¹ã‚³ã‚¢ï¼ˆä»®è¡¨ç¤ºï¼‰")
    st.info("ã“ã“ã«AIã‚¹ã‚³ã‚¢ã®çµæœãŒå…¥ã‚Šã¾ã™ã€‚ï¼ˆä»Šã¯ãƒ€ãƒŸãƒ¼è¡¨ç¤ºï¼‰")
    st.dataframe(df, width="stretch", hide_index=True)

# ---------------------------------------------------
# é¦¬åˆ¸ã‚¿ãƒ–ï¼ˆä»®ï¼‰
# ---------------------------------------------------
with tab_baken:
    st.subheader("ğŸ’´ é¦¬åˆ¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä»®ï¼‰")
    st.write("ã“ã“ã«é¦¬åˆ¸è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…äºˆå®šã€‚")

# ---------------------------------------------------
# åŸºæœ¬æƒ…å ±ã‚¿ãƒ–ï¼ˆä»®ï¼‰
# ---------------------------------------------------
with tab_info:
    st.subheader("ğŸ“„ ãƒ¬ãƒ¼ã‚¹åŸºæœ¬æƒ…å ±ï¼ˆä»®ï¼‰")
    st.write("ã“ã“ã«ãƒ¬ãƒ¼ã‚¹åãƒ»é–‹å‚¬å ´ãƒ»è·é›¢ãƒ»å¤©å€™ãƒ»é¦¬å ´ãªã©ã‚’è¡¨ç¤ºäºˆå®šã€‚")
